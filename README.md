# System Design —Å–æ—Ü–∏–∞–ª—å–Ω–æ–∏ÃÜ —Å–µ—Ç–∏ –¥–ª—è –∫—É—Ä—Å–∞ –ø–æ System Design
## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ
## 1) –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
1. –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–∏:
    - —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
    - 1..N —Ñ–æ—Ç–æ
    - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ location
2. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–æ—Å—Ç—ã:
    - –ª–µ–Ω—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ –æ–±—Ä–∞—Ç–Ω–æ–º —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ)
    - –¥–æ–º–∞—à–Ω—è—è –ª–µ–Ω—Ç–∞ (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –ø–æ–¥–ø–∏—Å–∫–∞–º, —Ç–æ–∂–µ DESC)
3. –°—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É/—Ä–µ–∞–∫—Ü–∏—é –ø–æ—Å—Ç—É
4. –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã
5. –ü–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤
6. –ò—Å–∫–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–æ—Å—Ç—ã –ø–æ –º–µ—Å—Ç—É

## 2) –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è 
–ê—É–¥–∏—Ç–æ—Ä–∏—è/–≥–µ–æ–≥—Ä–∞—Ñ–∏—è:
- –†–µ–≥–∏–æ–Ω: –°–ù–ì (–æ–¥–∏–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–≥–∏–æ–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è).
- –û–∂–∏–¥–∞–µ–º–∞—è –±–∞–∑–∞: –¥–æ **10 000 000 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –¥–µ–Ω—å** (DAU) .

–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
- **Availability 99.99%** –¥–ª—è —á—Ç–µ–Ω–∏—è –ª–µ–Ω—Ç—ã/–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ—Å—Ç–æ–≤.
  —Ç–∫ –ø—Ä–æ–¥—É–∫—Ç ‚Äú—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å‚Äù, –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî —á—Ç–µ–Ω–∏–µ –ª–µ–Ω—Ç—ã.

Latency (–æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ‚Äî ‚Äú–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—ã—Å—Ç—Ä–æ‚Äù):
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–µ–Ω—Ç—ã (home/user): p95 ‚â§ 300 ms (–±–µ–∑ —É—á–µ—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –æ–Ω–∏ —á–µ—Ä–µ–∑ CDN)
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞: p95 ‚â§ 1 s –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö + –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ (p95 ~ 2‚Äì3 s –Ω–∞ upload)
- –†–µ–∞–∫—Ü–∏–∏/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: p95 ‚â§ 200‚Äì300 ms
- –ü–æ–∏—Å–∫ –º–µ—Å—Ç: p95 ‚â§ 500 ms

–•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞:
- –ú–µ–¥–∏–∞ –Ω–µ –æ—Ç–¥–∞—ë–º —á–µ—Ä–µ–∑ backend, —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏/–∫–ª—é—á–∏ (CDN/s3).
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –º–µ–¥–∏–∞ –Ω–∞ –ø–æ—Å—Ç: **~5 MB**

Consistency:
- –î–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –ª–∞–π–∫–æ–≤/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –ª–µ–Ω—Ç—ã –¥–æ–ø—É—Å—Ç–∏–º–∞ eventual consistency (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ —Å–µ–∫—É–Ω–¥).

## 3) –í—Ö–æ–¥–Ω—ã–µ –¥–æ–ø—É—â–µ–Ω–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
DAU = 10 000 000.
–°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (rpd = requests per day –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞: 1 rpd 
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: 5 rpd
- –†–µ–∞–∫—Ü–∏–∏ (–ª–∞–π–∫): 10 rpd
- –ü–æ–¥–ø–∏—Å–∫–∞/–æ—Ç–ø–∏—Å–∫–∞: 1 rpd
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–µ–Ω—Ç—ã: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å (–ø–∞–≥–∏–Ω–∞—Ü–∏—è 20 –ø–æ—Å—Ç–æ–≤; –∏—Ç–æ–≥–æ 100 –ø–æ—Å—Ç–æ–≤/–¥–µ–Ω—å)
- –ü–æ–∏—Å–∫ –º–µ—Å—Ç: 1 –∑–∞–ø—Ä–æ—Å/–¥–µ–Ω—å (–ø–æ–∏—Å–∫/–ø–µ—Ä–µ—Ö–æ–¥ –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ)

–ü–∏–∫–æ–≤—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: Peak = x5 –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ (–≤–µ—á–µ—Ä/–≤—ã—Ö–æ–¥–Ω—ã–µ/–ø—Ä–∞–∑–¥–Ω–∏–∫–∏).

–§–æ—Ä–º—É–ª–∞:
RPS = DAU * rpd / 86400

## 4) –ù–∞–≥—Ä—É–∑–∫–∞ –≤ —Ä–∞–∑—Ä–µ–∑–µ –æ–ø–µ—Ä–∞—Ü–∏–π (RPS)
### Write-path
- CreatePost:
  avg RPS = 10e6 * 1 / 86400 ‚âà 116 rps, peak ‚âà 580 rps
- CreateComment:
  avg RPS = 10e6 * 5 / 86400 ‚âà 579 rps, peak ‚âà 2 895 rps
- PutLike:
  avg RPS = 10e6 * 10 / 86400 ‚âà 1 157 rps, peak ‚âà 5 785 rps
- Follow/Unfollow:
  avg RPS = 10e6 * 1 / 86400 ‚âà 116 rps, peak ‚âà 580 rps

### Read-path
- GetHomeFeed (20 –ø–æ—Å—Ç–æ–≤):
  avg RPS = 10e6 * 5 / 86400 ‚âà 579 rps, peak ‚âà 2 895 rps
- GetUserFeed (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º 2 –∑–∞–ø—Ä–æ—Å–∞/–¥–µ–Ω—å):
  avg RPS = 10e6 * 2 / 86400 ‚âà 231 rps, peak ‚âà 1 157 rps
- SearchPlaces (1 –∑–∞–ø—Ä–æ—Å/–¥–µ–Ω—å):
  avg RPS = 10e6 * 1 / 86400 ‚âà 116 rps, peak ‚âà 580 rps

## 5) –¢—Ä–∞—Ñ–∏–∫ (–≤–∞–∂–Ω–æ: –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ CDN, –Ω–µ —á–µ—Ä–µ–∑ API)
### 5.1. Upload –º–µ–¥–∏–∞ (–∫–ª–∏–µ–Ω—Ç -> storage/CDN)
–ï—Å–ª–∏ —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ upload –∏–¥—ë—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
- PostMediaUpload in:
  avg ‚âà CreatePost_RPS * 5MB ‚âà 116 * 5MB ‚âà 580 MB/s (peak ‚âà 2.9 GB/s)

### 5.2. API —Ç—Ä–∞—Ñ–∏–∫ (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)

- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –≤ –ª–µ–Ω—Ç–µ (id, user, place, text, counts, urls thumbnails) ~ 3KB
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–µ–Ω—Ç—ã 20 –ø–æ—Å—Ç–æ–≤ => ~60KB
- GetHomeFeed out:
  avg ‚âà 579 rps * 60KB ‚âà 34 MB/s (peak ‚âà 170 MB/s)

Write-–∑–∞–ø—Ä–æ—Å—ã (–ª–∞–π–∫/–∫–æ–º–º–µ–Ω—Ç/—Ñ–æ–ª–ª–æ—É) –ø–æ —Ç—Ä–∞—Ñ–∏–∫—É –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ –º–µ–Ω—å—à–µ (—Å–æ—Ç–Ω–∏ –±–∞–π—Ç‚Äì–ø–∞—Ä—ã –∫–∏–ª–æ–±–∞–π—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å)
–∏ –≤ –ø–µ—Ä–≤–æ–º –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∏–º–∏ –º–æ–∂–Ω–æ –ø—Ä–µ–Ω–µ–±—Ä–µ—á—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ª–µ–Ω—Ç–æ–π –∏ upload –º–µ–¥–∏–∞.


# üì¶ –û—Ü–µ–Ω–∫–∞ –¥–∏—Å–∫–æ–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (1 –≥–æ–¥)

–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–µ–∑–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º:
- –ø–æ—Å—Ç—ã
- –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- —Ä–µ–∞–∫—Ü–∏–∏
- –ø–æ–¥–ø–∏—Å–∫–∏
- –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã

---

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- DAU: **10 000 000**
- –ì–æ—Ä–∏–∑–æ–Ω—Ç –æ—Ü–µ–Ω–∫–∏: **1 –≥–æ–¥ (365 –¥–Ω–µ–π)**

–°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
- 1 –ø–æ—Å—Ç / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å / –¥–µ–Ω—å
- 5 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å / –¥–µ–Ω—å
- 10 —Ä–µ–∞–∫—Ü–∏–π / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å / –¥–µ–Ω—å
- 1 –ø–æ–¥–ø–∏—Å–∫–∞ / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å / –¥–µ–Ω—å

---

## üóÇÔ∏è –û—Ü–µ–Ω–∫–∞ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö (capacity)

### üìå –ü–æ—Å—Ç—ã
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞:
- id, user_id, place_id
- —Ç–µ–∫—Å—Ç
- timestamps
- –∞–≥—Ä–µ–≥–∞—Ç—ã (reactions_count, comments_count)

‚âà **1 KB –Ω–∞ –ø–æ—Å—Ç**

```

10 000 000 –ø–æ—Å—Ç–æ–≤ / –¥–µ–Ω—å
‚Üí 3.65 –º–ª—Ä–¥ –ø–æ—Å—Ç–æ–≤ / –≥–æ–¥
‚Üí 3.65 –¢–ë / –≥–æ–¥

```

---

### üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:
- id, post_id, user_id
- —Ç–µ–∫—Å—Ç
- created_at

‚âà **0.5 KB –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π**

```

10 000 000 * 5 = 50 000 000 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ / –¥–µ–Ω—å
‚Üí 18.25 –º–ª—Ä–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ / –≥–æ–¥
‚Üí ~9.1 –¢–ë / –≥–æ–¥

```

---

### üëç –†–µ–∞–∫—Ü–∏–∏
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏:
- post_id
- user_id
- value
- timestamp

‚âà **100 B**

```

10 000 000 * 10 = 100 000 000 —Ä–µ–∞–∫—Ü–∏–π / –¥–µ–Ω—å
‚Üí 36.5 –º–ª—Ä–¥ —Ä–µ–∞–∫—Ü–∏–π / –≥–æ–¥
‚Üí ~3.65 –¢–ë / –≥–æ–¥

```

---

### üë• –ü–æ–¥–ø–∏—Å–∫–∏
–û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –ø–æ–¥–ø–∏—Å–∫–∏:
- follower_id
- followed_id
- created_at

‚âà **100 B**

```

10 000 000 –ø–æ–¥–ø–∏—Å–æ–∫ / –¥–µ–Ω—å
‚Üí 3.65 –º–ª—Ä–¥ –ø–æ–¥–ø–∏—Å–æ–∫ / –≥–æ–¥
‚Üí ~0.36 –¢–ë / –≥–æ–¥

```

---

### üñºÔ∏è –ú–µ–¥–∏–∞ (object storage, –Ω–µ –ë–î)
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –º–µ–¥–∏–∞ –Ω–∞ –ø–æ—Å—Ç: **5 MB**
- –ú–µ–¥–∏–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ object storage + CDN

```

10 000 000 –ø–æ—Å—Ç–æ–≤ / –¥–µ–Ω—å * 5 MB
‚Üí ~50 TB / –¥–µ–Ω—å
‚Üí ~18 PB / –≥–æ–¥

```

> ‚ö†Ô∏è –ú–µ–¥–∏–∞ **–Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è** –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –¥–∏—Å–∫–æ–≤ –¥–ª—è –ë–î  
> (–æ–Ω–∏ –∂–∏–≤—É—Ç –≤ S3 + CDN –∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ).

