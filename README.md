# System Design социальной сети для курса по System Design
## Требования к системе
## 1) Функциональные требования
Пользователь может:
1. Публиковать пост о путешествии:
    - текстовое описание
    - 1..N фото
    - привязка к location
2. Просматривать посты:
    - лента конкретного пользователя (в обратном хронологическом порядке)
    - домашняя лента (агрегация по подпискам, тоже DESC)
3. Ставить оценку/реакцию посту
4. Комментировать посты
5. Подписываться на других путешественников
6. Искать популярные места для путешествий и просматривать посты по месту

## 2) Нефункциональные требования 
Аудитория/география:
- Регион: СНГ (один основной регион развертывания).
- Ожидаемая база: до **10 000 000 уникальных пользователей в день** (DAU) .

Доступность:
- **Availability 99.99%** для чтения ленты/просмотра постов.
  тк продукт “социальная сеть”, основной сценарий — чтение ленты.

Latency (ожидание от разработки — “должно быть быстро”):
- Просмотр ленты (home/user): p95 ≤ 300 ms (без учета загрузки изображений, они через CDN)
- Публикация поста: p95 ≤ 1 s на создание метаданных + отдельная загрузка медиа (p95 ~ 2–3 s на upload)
- Реакции/комментарии: p95 ≤ 200–300 ms
- Поиск мест: p95 ≤ 500 ms

Хранение медиа:
- Медиа не отдаём через backend, только ссылки/ключи (CDN/s3).
- Средний размер медиа на пост: **~5 MB**

Consistency:
- Для счетчиков лайков/комментариев и ленты допустима eventual consistency (обновление в течение секунд).

## 3) Входные допущения для оценки нагрузки
DAU = 10 000 000.
Средняя активность (rpd = requests per day на пользователя):
- Создание поста: 1 rpd 
- Комментарии: 5 rpd
- Реакции (лайк): 10 rpd
- Подписка/отписка: 1 rpd
- Просмотр ленты: 5 запросов/день (пагинация 20 постов; итого 100 постов/день)
- Поиск мест: 1 запрос/день (поиск/переход в популярные)

Пиковый коэффициент: Peak = x5 от среднего (вечер/выходные/праздники).

Формула:
RPS = DAU * rpd / 86400

## 4) Нагрузка в разрезе операций (RPS)
### Write-path
- CreatePost:
  avg RPS = 10e6 * 1 / 86400 ≈ 116 rps, peak ≈ 580 rps
- CreateComment:
  avg RPS = 10e6 * 5 / 86400 ≈ 579 rps, peak ≈ 2 895 rps
- PutLike:
  avg RPS = 10e6 * 10 / 86400 ≈ 1 157 rps, peak ≈ 5 785 rps
- Follow/Unfollow:
  avg RPS = 10e6 * 1 / 86400 ≈ 116 rps, peak ≈ 580 rps

### Read-path
- GetHomeFeed (20 постов):
  avg RPS = 10e6 * 5 / 86400 ≈ 579 rps, peak ≈ 2 895 rps
- GetUserFeed (предположим 2 запроса/день):
  avg RPS = 10e6 * 2 / 86400 ≈ 231 rps, peak ≈ 1 157 rps
- SearchPlaces (1 запрос/день):
  avg RPS = 10e6 * 1 / 86400 ≈ 116 rps, peak ≈ 580 rps

## 5) Трафик (важно: медиа через CDN, не через API)
### 5.1. Upload медиа (клиент -> storage/CDN)
Если считать, что upload идёт напрямую в объектное хранилище:
- PostMediaUpload in:
  avg ≈ CreatePost_RPS * 5MB ≈ 116 * 5MB ≈ 580 MB/s (peak ≈ 2.9 GB/s)

### 5.2. API трафик (метаданные)

- Метаданные одного поста в ленте (id, user, place, text, counts, urls thumbnails) ~ 3KB
- Страница ленты 20 постов => ~60KB
- GetHomeFeed out:
  avg ≈ 579 rps * 60KB ≈ 34 MB/s (peak ≈ 170 MB/s)

Write-запросы (лайк/коммент/фоллоу) по трафику на порядок меньше (сотни байт–пары килобайт на запрос)
и в первом приближении ими можно пренебречь по сравнению с лентой и upload медиа.